import json
from db_client import get_db_client


def upload_records_from_dict(data_dict: dict, status: str):
    """
    Функция принимает на вход статус (status) и словарь вида:
    {
        "advertpro": [{...}, {...}, ... ],
        "kilimandjaro": [{...}, ... ],
        ...
    }
    где каждый ключ (advertpro, kilimandjaro и т.д.) — это имя таблицы в БД.

    Логика обновления:
    1. Если 'data' нет или оно пустое, пропускаем обновление data и статуса.
    2. Если 'data' есть, проверяем массив 'criteria' внутри data на полноту:
       - должны присутствовать поля: name, description, isEvaluated, evaluation, text.
       - если хотя бы одно отсутствует — обновляем только data (статус не трогаем).
       - если все поля есть во всех объектах 'criteria' — обновляем data и ставим status равным аргументу функции (status).
    По окончании всех обновлений вызываем commit.
    """

    required_fields = ["name", "description", "isEvaluated", "evaluation", "text"]

    with get_db_client() as conn:
        with conn.cursor() as cur:
            # Перебираем все таблицы (ключи верхнего уровня)
            for table_name, records in data_dict.items():
                # Перебираем каждую запись в списке
                for record in records:
                    # Проверяем, есть ли поле 'data'
                    record_data = record.get("data")
                    if not record_data:
                        # Если data нет или оно пустое — ничего не обновляем, идём дальше
                        continue

                    # Предполагаем, что нужно проверить массив criteria
                    criteria_list = record_data.get("criteria")

                    # Если criteria нет или оно не список — тогда считаем, что данных недостаточно
                    # Обновляем только data (без изменения статуса).
                    if not isinstance(criteria_list, list):
                        update_query = f"""
                            UPDATE {table_name}
                            SET data = %s
                            WHERE id = %s
                        """
                        cur.execute(update_query, [json.dumps(record_data), record["id"]])
                        continue

                    # Проверяем наличие всех обязательных полей в каждом элементе criteria
                    all_criteria_ok = True
                    for crit in criteria_list:
                        if not all(field in crit for field in required_fields):
                            all_criteria_ok = False
                            break

                    if all_criteria_ok:
                        # Все поля в criteria на месте => обновляем data и ставим статус = 'status' из аргумента
                        update_query = f"""
                            UPDATE {table_name}
                            SET data = %s,
                                status = %s
                            WHERE id = %s
                        """
                        cur.execute(update_query, [json.dumps(record_data), status, record["id"]])
                    else:
                        # Какие-то поля не хватает => обновляем только data
                        update_query = f"""
                            UPDATE {table_name}
                            SET data = %s
                            WHERE id = %s
                        """
                        cur.execute(update_query, [json.dumps(record_data), record["id"]])

            # Фиксируем изменения в БД
            conn.commit()


# Пример использования
if __name__ == "__main__":
    dialogue_dict = {
        "advertpro": [
            {
                "id": "2025-02-07 14-06-46 +79017273323.mp3",
                "dialogue": "М: Да, Сергей, здравствуйте, это опять Сергей.\nК: Да, слушаю.\nМ: Да, смотрите, посмотрел домен, вот в целом сайт у вас большой, я так понимаю, много чем занимаетесь, как от аренды до обслуживания. А касаемо вот модернизации, я вижу, что в целом можно сайт просто чуть так назовем причесать. Или вы какие-то кардинальные изменения в нем хотели сделать?\nК: Ну я даже не знаю, как это назвать, вот мы хотим для чего, что люди там на планшете, старый, грубо говоря, вот убрать его.\nМ: Кого, еще раз?\nК: Там, я не знаю, ну если на главную страничку заходите, видите там планшет, он уже старый.\nМ: Ну да.\nК: Вот его поменять, убрать, не знаю, вот сделать какой-нибудь ребрендинг что ли сайт, не знаю, как это еще, обновить его. То есть, если честно, такого четкого понимания нет, но хочу обновить сайт, информацию добавить вот.\nМ: Угу.\nК: В разделе наши работы добавлять очень много информации, что мы грубо сделали, они там не добавлены.\nМ: Угу.\nК: Откуда в день ничего не добавлялось, вот это все там добавлять. Я не знаю как еще, может у вас какие-то еще будут предложения?\nМ: Угу, я понял. Да, Сергей, смотрите тут опять же все предложения они зависят от бюджета, который есть у клиента, например, если там.\nК: Нет такого понимания, ну 100-200 тысяч вот так максимум.\nМ: 100-200 тысяч, я понял, 200 тысяч, так хорошо. В целом, в целом как бы больше вопросов нет, я тогда в этом бюджете вам накидаю несколько вариантов, что можно сделать, вот вы тогда посмотрите. Давайте по срокам готовности вас сориентирую в понедельник до конца дня.\nК: У, хорошо.\nМ: Вот да, единственное, я вижу то, что он у вас на ModX и приставка x3 ну это.\nК: На чем? Это что такое?\nМ: CMS, ну платформа ModX в целом как бы.\nК: Я не разбираюсь в этом.\nМ: Ну я понял, да, вот соответственно, мы посмотрим, посчитаем, отобразим и вернусь к вам в понедельник до конца дня, удобно будет?\nК: Да, хорошо.\nМ: Все, все хорошо, Сергей, тогда на связи будем.\nК: Угу, до свидания.\nМ: До свидания.\n",
                "criteria": {
                    "criteria": [
                        {
                            "name": "Факты о компании",
                            "description": "Вам предоставлен транскрипт разговора менеджера с клиентом. Ваша задача - выделить основные ключевые факты о клиенте из этого разговора, чтобы можно было быстро ознакомиться с клиентом.\n1. Сформулируйте каждый ключевой факт кратко и четко, в формате пункт + значение (например: компания-производитель велосипедов, штат: 50 человек, заявки из контекстной рекламы).\n2. Запрещено использовать слова, которые не несут практической информации, перефразировать и расшифровывать.\n3. По возможности применять сокращения, например вместо рублей - р, вместо тысяч - тыс, вместо год - г и тд.\n4. Представь выделенные ключевые факты в виде маркированного списка.\n5. Проанализируй предоставленный транскрипт и:\n5.1. Укажи: только сухие факты о клиенте, что по факту есть у клиента на текущий момент, особенно важны цифровые данные, даты, названия.\n5.2. Запрещено указывать: потребности, боли, задачи, возражения, проблемы, текущие договоренности, контактные данные, бюджеты и цены, даже ориентировочные.\n5.3. Запрещено указывать бюджеты и цены, даже ориентировочные\n5.4. Запрещено давать твою оценку",
                            "isEvaluated": True,
                            "text": "- клиент: Сергей\n- сайт: большой\n- направления: аренда, обслуживание\n- необходимость: обновление сайта\n- основная платформа: ModX (x3)\n- бюджет: 100-200 тыс\n- раздел для обновления: наши работы",
                            "evaluation": 3.8
                        }
                    ],
                    "categories": [
                        {
                            "name": "Продвижение сайтов новый клиент",
                            "description": "Клиент заинтересован в услуге продвижение сайтов, однозначно подтвердил лично, что ему интересна данная услуга, из разговора следует, что у него нет действующего контракта по этой услуге, клиент общается явно с МОП",
                            "criteriaNames": [
                                "Факты о компании"
                            ]
                        },
                        {
                            "name": "Аренда сайтов новый клиент",
                            "description": "Клиент заинтересован взять сайт в аренду в АдвертПро, однозначно подтвердил лично, что ему интересна данная услуга, из разговора следует, что он не арендует ни одного сайта от АдвертПро, клиент общается явно с МОП",
                            "criteriaNames": [
                                "Факты о компании"
                            ]
                        },
                        {
                            "name": "Зарубежное продвижение сайтов новый клиент",
                            "description": "Клиент заинтересован в услуге Зарубежное продвижение сайтов, однозначно подтвердил лично, что ему интересна данная услуга, из разговора следует, что у него нет действующего контракта по этой услуге, клиент общается явно с МОП",
                            "criteriaNames": [
                                "Факты о компании"
                            ]
                        },
                        {
                            "name": "Управление репутацией SERM, ORM новый клиент",
                            "description": "Клиент заинтересован в услуге Управление репутацией SERM, ORM, однозначно подтвердил лично, что ему интересна данная услуга, из разговора следует, что у него нет действующего контракта по этой услуге, клиент общается явно с МОП",
                            "criteriaNames": [
                                "Факты о компании"
                            ]
                        },
                        {
                            "name": "Продвижение в Яндекс Картах новый клиент",
                            "description": "Клиент заинтересован в услуге Продвижение в Яндекс Картах, однозначно подтвердил лично, что ему интересна данная услуга, из разговора следует, что у него нет действующего контракта по этой услуге, клиент общается явно с МОП",
                            "criteriaNames": [
                                "Факты о компании"
                            ]
                        },
                        {
                            "name": "Контекстная реклама новый клиент",
                            "description": "Клиент заинтересован в услуге Контекстная реклама, однозначно подтвердил лично, что ему интересна данная услуга, из разговора следует, что у него нет действующего контракта по этой услуге, клиент общается явно с МОП",
                            "criteriaNames": [
                                "Факты о компании"
                            ]
                        },
                        {
                            "name": "Создание сайтов новый клиент",
                            "description": "Клиент заинтересован в услуге Разработка сайтов, однозначно подтвердил лично, что ему интересна данная услуга, из разговора следует, что у него нет действующего контракта по этой услуге, клиент общается явно с МОП",
                            "criteriaNames": [
                                "Факты о компании"
                            ]
                        },
                        {
                            "name": "Техническая поддержка сайтов новый клиент",
                            "description": "Клиент заинтересован в услуге Техническая поддержка сайтов, однозначно подтвердил лично, что ему интересна данная услуга, из разговора следует, что у него нет действующего контракта по этой услуге, клиент общается явно с МОП",
                            "criteriaNames": [
                                "Факты о компании"
                            ]
                        },
                        {
                            "name": "Веб-аналитика новый клиент",
                            "description": "Клиент заинтересован в услуге Веб-аналитика, однозначно подтвердил лично, что ему интересна данная услуга, из разговора следует, что у него нет действующего контракта по этой услуге, клиент общается явно с МОП",
                            "criteriaNames": [
                                "Факты о компании"
                            ]
                        },
                        {
                            "name": "Внедрение CRM Битрикс 24 новый клиент",
                            "description": "Клиент заинтересован в услуге Внедрение CRM Битрикс 24 (хочет, чтобы ему настроили CRM Битрикс 24), однозначно подтвердил лично, что ему интересна данная услуга, из разговора следует, что у него нет действующего контракта по этой услуге, клиент общается явно с МОП",
                            "criteriaNames": [
                                "Факты о компании"
                            ]
                        },
                        {
                            "name": "Продвижение сайтов текущий клиент",
                            "description": "Клиент общается по услуге Продвижение сайтов, очевидно, что у него есть действующий контракт по этой услуге и клиент общается явно с аккаунт-менеджером",
                            "criteriaNames": [
                                "Факты о компании"
                            ]
                        },
                        {
                            "name": "Аренда сайтов текущий клиент",
                            "description": "Клиент общается по поводу сайта в аренду, который он уже арендует в АдвертПро, и он общается с аккаунт-менеджером компании АдвертПро",
                            "criteriaNames": [
                                "Факты о компании"
                            ]
                        },
                        {
                            "name": "Зарубежное продвижение сайтов текущий клиент",
                            "description": "Клиент общается по услуге Зарубежное продвижение сайтов, очевидно, что у него есть действующий контракт по этой услуге и клиент общается явно с аккаунт-менеджером",
                            "criteriaNames": [
                                "Факты о компании"
                            ]
                        },
                        {
                            "name": "Управление репутацией SERM, ORM текущий клиент",
                            "description": "Клиент общается по услуге Управление репутацией SERM, ORM, очевидно, что у него есть действующий контракт по этой услуге и клиент общается явно с аккаунт-менеджером",
                            "criteriaNames": [
                                "Факты о компании"
                            ]
                        },
                        {
                            "name": "Продвижение в Яндекс Картах текущий клиент",
                            "description": "Клиент общается по услуге Продвижение в Яндекс Картах, очевидно, что у него есть действующий контракт по этой услуге и клиент общается явно с аккаунт-менеджером",
                            "criteriaNames": [
                                "Факты о компании"
                            ]
                        },
                        {
                            "name": "Контекстная реклама текущий клиент",
                            "description": "Клиент общается по услуге Контекстная реклама, очевидно, что у него есть действующий контракт по этой услуге и клиент общается явно с аккаунт-менеджером",
                            "criteriaNames": [
                                "Факты о компании"
                            ]
                        },
                        {
                            "name": "Создание сайтов текущий клиент",
                            "description": "Клиент общается по услуге Разработка сайтов, очевидно, что у него есть действующий контракт по этой услуге, сайт на стадии разработки, и клиент общается явно с аккаунт-менеджером",
                            "criteriaNames": [
                                "Факты о компании"
                            ]
                        },
                        {
                            "name": "Техническая поддержка сайтов текущий клиент",
                            "description": "Клиент общается по услуге Техническая поддержка сайтов, очевидно, что у него есть действующий контракт по этой услуге и клиент общается явно с аккаунт-менеджером",
                            "criteriaNames": [
                                "Факты о компании"
                            ]
                        },
                        {
                            "name": "Веб-аналитика текущий клиент",
                            "description": "Клиент общается по услуге Веб-аналитика, очевидно, что у него есть действующий контракт по этой услуге и клиент общается явно с аккаунт-менеджером",
                            "criteriaNames": [
                                "Факты о компании"
                            ]
                        },
                        {
                            "name": "Внедрение CRM Битрикс 24 текущий клиент",
                            "description": "Клиент общается по услуге Внедрение Битрикс 24, очевидно, что у него есть действующий контракт по этой услуге, идет рабочее согласование по настройке Битрикс 24, и клиент общается явно с аккаунт-менеджером",
                            "criteriaNames": [
                                "Факты о компании"
                            ]
                        },
                        {
                            "name": "Спам",
                            "description": "Диалог не относится ни к одной категории, менеджеру АдвертПро звонят из другой компании и предлагают заказать какие-то услуги, менеджер отказывается от предложения",
                            "criteriaNames": []
                        },
                        {
                            "name": "Не определен",
                            "description": "Диалог не принадлежит ни к одной категории в текущем словаре",
                            "criteriaNames": []
                        }
                    ]
                },
                "data": {
                    "categories": ["Создание сайтов новый клиент"],
                    "criteria": [
                        {
                            "name": "Факты о компании",
                            "description": "Вам предоставлен транскрипт разговора менеджера с клиентом. Ваша задача - выделить основные ключевые факты о клиенте из этого разговора, чтобы можно было быстро ознакомиться с клиентом.\n1. Сформулируйте каждый ключевой факт кратко и четко, в формате пункт + значение (например: компания-производитель велосипедов, штат: 50 человек, заявки из контекстной рекламы).\n2. Запрещено использовать слова, которые не несут практической информации, перефразировать и расшифровывать.\n3. По возможности применять сокращения, например вместо рублей - р, вместо тысяч - тыс, вместо год - г и тд.\n4. Представь выделенные ключевые факты в виде маркированного списка.\n5. Проанализируй предоставленный транскрипт и:\n5.1. Укажи: только сухие факты о клиенте, что по факту есть у клиента на текущий момент, особенно важны цифровые данные, даты, названия.\n5.2. Запрещено указывать: потребности, боли, задачи, возражения, проблемы, текущие договоренности, контактные данные, бюджеты и цены, даже ориентировочные.\n5.3. Запрещено указывать бюджеты и цены, даже ориентировочные\n5.4. Запрещено давать твою оценку",
                            "isEvaluated": True,
                            "text": "- клиент: Сергей\n- сайт: большой\n- направления: аренда, обслуживание\n- необходимость: обновление сайта\n- основная платформа: ModX (x3)\n- бюджет: 100-200 тыс\n- раздел для обновления: наши работы",
                            "evaluation": 3.8
                        }
                    ]
                }
            }
        ],
        "kilimandjaro": [
            {
                "id": "2025-02-07 14-06-46 +79017273323.mp3",
                "dialogue": "М: Да, Сергей, здравствуйте, это опять Сергей.\nК: Да, слушаю.\nМ: Да, смотрите, посмотрел домен, вот в целом сайт у вас большой, я так понимаю, много чем занимаетесь, как от аренды до обслуживания. А касаемо вот модернизации, я вижу, что в целом можно сайт просто чуть, так назовём, причесать, или вы какие-то кардинальные изменения в нём хотели сделать?\nК: Ну, я даже не знаю, как это назвать, вот мы хотим для чего, чтобы люди там на планшете старый, грубо говоря, вот убрать его.\nМ: Кого, ещё раз?\nК: Там, я не знаю, ну если на главную страничку заходите, видите, там планшет, он уже старый.\nМ: Ну да.\nК: Вот его поменять, убрать, не знаю, вот сделать какой-нибудь ребрендинг, что ли, сайт, не знаю как это ещё, обновить его, то есть, если честно, такого чёткого понимания нет, но хочу обновить сайт, информацию добавить, вот.\nМ: Угу.\nК: В разделе Наши работы добавлять очень много информации, что мы гробы сделали, они там не добавлены.\nМ: Угу.\nК: Откуда в день ничего не добавлялось, вот это всё там добавлять, я не знаю как ещё, может у вас какие-то ещё будут предложения.\nМ: Угу, я понял. Да, Сергей, смотрите, тут опять же, все предложения, они зависят от бюджета, который есть у клиента. Например, если там...\nК: Нет такого понимания, ну сто, двести тысяч, вот так максимум.\nМ: Сто, двести тысяч, я понял, двести тысяч. Так, хорошо, в целом, в целом как бы больше вопросов нет. Я тогда в этом бюджете вам накидаю несколько вариантов, что можно сделать, вот вы тогда посмотрите. Давайте по срокам готовности вас сориентирую в понедельник до конца дня.\nК: У, хорошо.\nМ: Вот да, единственное, я вижу то, что он у вас на ModX и приставка с тройной W, ну это...\nК: На чём? Это что такое?\nМ: CMS, ну платформа ModX в целом, как бы...\nК: Я не разбираюсь в этом.\nМ: Ну я понял, да, вот, соответственно, мы посмотрим, посчитаем, отобразим и вернусь к вам в понедельник до конца дня. Удобно будет?\nК: Да, хорошо.\nМ: Всё, всё хорошо, Сергей, тогда на связи будем.\nК: Угу, до свидания.\nМ: До свидания.\n",
                "criteria": {
                    "criteria": [
                        {
                            "name": "Факты о компании",
                            "description": "Вам предоставлен транскрипт разговора менеджера с клиентом. Ваша задача - выделить основные ключевые факты о клиенте из этого разговора, чтобы можно было быстро ознакомиться с клиентом.\n1. Сформулируйте каждый ключевой факт кратко и четко, в формате пункт + значение (например: компания-производитель велосипедов, штат: 50 человек, заявки из контекстной рекламы).\n2. Запрещено использовать слова, которые не несут практической информации, перефразировать и расшифровывать.\n3. По возможности применять сокращения, например вместо рублей - р, вместо тысяч - тыс, вместо год - г и тд.\n4. Представь выделенные ключевые факты в виде маркированного списка.\n5. Проанализируй предоставленный транскрипт и:\n5.1. Укажи: только сухие факты о клиенте, что по факту есть у клиента на текущий момент, особенно важны цифровые данные, даты, названия.\n5.2. Запрещено указывать: потребности, боли, задачи, возражения, проблемы, текущие договоренности, контактные данные, бюджеты и цены, даже ориентировочные.\n5.3. Запрещено указывать бюджеты и цены, даже ориентировочные\n5.4. Запрещено давать твою оценку",
                            "isEvaluated": False,
                            "text": "- клиент: Сергей\n- тип бизнеса: аренда и обслуживание\n- текущее состояние сайта: большой сайт, требуется обновление\n- платформа сайта: ModX\n- запланированное обновление: добавить информацию о работах\n- бюджет: 100-200 тыс р\n- срок получения предложений: понедельник до конца дня\n",
                            "evaluation": None
                        }
                    ],
                    "categories": [
                        {
                            "name": "Продвижение сайтов новый клиент",
                            "description": "Клиент заинтересован в услуге продвижение сайтов, однозначно подтвердил лично, что ему интересна данная услуга, из разговора следует, что у него нет действующего контракта по этой услуге, клиент общается явно с МОП",
                            "criteriaNames": [
                                "Факты о компании"
                            ]
                        },
                        {
                            "name": "Аренда сайтов новый клиент",
                            "description": "Клиент заинтересован взять сайт в аренду в АдвертПро, однозначно подтвердил лично, что ему интересна данная услуга, из разговора следует, что он не арендует ни одного сайта от АдвертПро, клиент общается явно с МОП",
                            "criteriaNames": [
                                "Факты о компании"
                            ]
                        },
                        {
                            "name": "Зарубежное продвижение сайтов новый клиент",
                            "description": "Клиент заинтересован в услуге Зарубежное продвижение сайтов, однозначно подтвердил лично, что ему интересна данная услуга, из разговора следует, что у него нет действующего контракта по этой услуге, клиент общается явно с МОП",
                            "criteriaNames": [
                                "Факты о компании"
                            ]
                        },
                        {
                            "name": "Управление репутацией SERM, ORM новый клиент",
                            "description": "Клиент заинтересован в услуге Управление репутацией SERM, ORM, однозначно подтвердил лично, что ему интересна данная услуга, из разговора следует, что у него нет действующего контракта по этой услуге, клиент общается явно с МОП",
                            "criteriaNames": [
                                "Факты о компании"
                            ]
                        },
                        {
                            "name": "Продвижение в Яндекс Картах новый клиент",
                            "description": "Клиент заинтересован в услуге Продвижение в Яндекс Картах, однозначно подтвердил лично, что ему интересна данная услуга, из разговора следует, что у него нет действующего контракта по этой услуге, клиент общается явно с МОП",
                            "criteriaNames": [
                                "Факты о компании"
                            ]
                        },
                        {
                            "name": "Контекстная реклама новый клиент",
                            "description": "Клиент заинтересован в услуге Контекстная реклама, однозначно подтвердил лично, что ему интересна данная услуга, из разговора следует, что у него нет действующего контракта по этой услуге, клиент общается явно с МОП",
                            "criteriaNames": [
                                "Факты о компании"
                            ]
                        },
                        {
                            "name": "Создание сайтов новый клиент",
                            "description": "Клиент заинтересован в услуге Разработка сайтов, однозначно подтвердил лично, что ему интересна данная услуга, из разговора следует, что у него нет действующего контракта по этой услуге, клиент общается явно с МОП",
                            "criteriaNames": [
                                "Факты о компании"
                            ]
                        },
                        {
                            "name": "Техническая поддержка сайтов новый клиент",
                            "description": "Клиент заинтересован в услуге Техническая поддержка сайтов, однозначно подтвердил лично, что ему интересна данная услуга, из разговора следует, что у него нет действующего контракта по этой услуге, клиент общается явно с МОП",
                            "criteriaNames": [
                                "Факты о компании"
                            ]
                        },
                        {
                            "name": "Веб-аналитика новый клиент",
                            "description": "Клиент заинтересован в услуге Веб-аналитика, однозначно подтвердил лично, что ему интересна данная услуга, из разговора следует, что у него нет действующего контракта по этой услуге, клиент общается явно с МОП",
                            "criteriaNames": [
                                "Факты о компании"
                            ]
                        },
                        {
                            "name": "Внедрение CRM Битрикс 24 новый клиент",
                            "description": "Клиент заинтересован в услуге Внедрение CRM Битрикс 24 (хочет, чтобы ему настроили CRM Битрикс 24), однозначно подтвердил лично, что ему интересна данная услуга, из разговора следует, что у него нет действующего контракта по этой услуге, клиент общается явно с МОП",
                            "criteriaNames": [
                                "Факты о компании"
                            ]
                        },
                        {
                            "name": "Продвижение сайтов текущий клиент",
                            "description": "Клиент общается по услуге Продвижение сайтов, очевидно, что у него есть действующий контракт по этой услуге и клиент общается явно с аккаунт-менеджером",
                            "criteriaNames": [
                                "Факты о компании"
                            ]
                        },
                        {
                            "name": "Аренда сайтов текущий клиент",
                            "description": "Клиент общается по поводу сайта в аренду, который он уже арендует в АдвертПро, и он общается с аккаунт-менеджером компании АдвертПро",
                            "criteriaNames": [
                                "Факты о компании"
                            ]
                        },
                        {
                            "name": "Зарубежное продвижение сайтов текущий клиент",
                            "description": "Клиент общается по услуге Зарубежное продвижение сайтов, очевидно, что у него есть действующий контракт по этой услуге и клиент общается явно с аккаунт-менеджером",
                            "criteriaNames": [
                                "Факты о компании"
                            ]
                        },
                        {
                            "name": "Управление репутацией SERM, ORM текущий клиент",
                            "description": "Клиент общается по услуге Управление репутацией SERM, ORM, очевидно, что у него есть действующий контракт по этой услуге и клиент общается явно с аккаунт-менеджером",
                            "criteriaNames": [
                                "Факты о компании"
                            ]
                        },
                        {
                            "name": "Продвижение в Яндекс Картах текущий клиент",
                            "description": "Клиент общается по услуге Продвижение в Яндекс Картах, очевидно, что у него есть действующий контракт по этой услуге и клиент общается явно с аккаунт-менеджером",
                            "criteriaNames": [
                                "Факты о компании"
                            ]
                        },
                        {
                            "name": "Контекстная реклама текущий клиент",
                            "description": "Клиент общается по услуге Контекстная реклама, очевидно, что у него есть действующий контракт по этой услуге и клиент общается явно с аккаунт-менеджером",
                            "criteriaNames": [
                                "Факты о компании"
                            ]
                        },
                        {
                            "name": "Создание сайтов текущий клиент",
                            "description": "Клиент общается по услуге Разработка сайтов, очевидно, что у него есть действующий контракт по этой услуге, сайт на стадии разработки, и клиент общается явно с аккаунт-менеджером",
                            "criteriaNames": [
                                "Факты о компании"
                            ]
                        },
                        {
                            "name": "Техническая поддержка сайтов текущий клиент",
                            "description": "Клиент общается по услуге Техническая поддержка сайтов, очевидно, что у него есть действующий контракт по этой услуге и клиент общается явно с аккаунт-менеджером",
                            "criteriaNames": [
                                "Факты о компании"
                            ]
                        },
                        {
                            "name": "Веб-аналитика текущий клиент",
                            "description": "Клиент общается по услуге Веб-аналитика, очевидно, что у него есть действующий контракт по этой услуге и клиент общается явно с аккаунт-менеджером",
                            "criteriaNames": [
                                "Факты о компании"
                            ]
                        },
                        {
                            "name": "Внедрение CRM Битрикс 24 текущий клиент",
                            "description": "Клиент общается по услуге Внедрение Битрикс 24, очевидно, что у него есть действующий контракт по этой услуге, идет рабочее согласование по настройке Битрикс 24, и клиент общается явно с аккаунт-менеджером",
                            "criteriaNames": [
                                "Факты о компании"
                            ]
                        },
                        {
                            "name": "Спам",
                            "description": "Диалог не относится ни к одной категории, менеджеру АдвертПро звонят из другой компании и предлагают заказать какие-то услуги, менеджер отказывается от предложения",
                            "criteriaNames": []
                        },
                        {
                            "name": "Не определен",
                            "description": "Диалог не принадлежит ни к одной категории в текущем словаре",
                            "criteriaNames": []
                        }
                    ]
                },
                "data": {
                    "categories": ["Создание сайтов новый клиент"],
                    "criteria": [
                        {
                            "name": "Факты о компании",
                            "description": "Вам предоставлен транскрипт разговора менеджера с клиентом. Ваша задача - выделить основные ключевые факты о клиенте из этого разговора, чтобы можно было быстро ознакомиться с клиентом.\n1. Сформулируйте каждый ключевой факт кратко и четко, в формате пункт + значение (например: компания-производитель велосипедов, штат: 50 человек, заявки из контекстной рекламы).\n2. Запрещено использовать слова, которые не несут практической информации, перефразировать и расшифровывать.\n3. По возможности применять сокращения, например вместо рублей - р, вместо тысяч - тыс, вместо год - г и тд.\n4. Представь выделенные ключевые факты в виде маркированного списка.\n5. Проанализируй предоставленный транскрипт и:\n5.1. Укажи: только сухие факты о клиенте, что по факту есть у клиента на текущий момент, особенно важны цифровые данные, даты, названия.\n5.2. Запрещено указывать: потребности, боли, задачи, возражения, проблемы, текущие договоренности, контактные данные, бюджеты и цены, даже ориентировочные.\n5.3. Запрещено указывать бюджеты и цены, даже ориентировочные\n5.4. Запрещено давать твою оценку",
                            "isEvaluated": False,
                            "text": "- клиент: Сергей\n- тип бизнеса: аренда и обслуживание\n- текущее состояние сайта: большой сайт, требуется обновление\n- платформа сайта: ModX\n- запланированное обновление: добавить информацию о работах\n- бюджет: 100-200 тыс р\n- срок получения предложений: понедельник до конца дня\n",
                            "evaluation": None
                        }
                    ]
                }
            }
        ]
    }
    upload_records_from_dict(dialogue_dict)
